#!/bin/bash

set -e

api_key() {
  if [[ $BILLFORWARD_API_KEY ]]; then
    echo $BILLFORWARD_API_KEY
  else
    ruby -ryaml -e "puts YAML.load(File.read('config/billforward.yml')).dig('development', 'access_token')"
  fi
}

# Upcase HTTP verb
method=$(echo $1 | tr "[a-z]" "[A-Z]")
shift

# Strip leading /v1/ for consistency
request_path="${1#/v1}"
request_path="${request_path#/}"
shift

exec curl "https://api-sandbox.billforward.net:443/v1/${request_path}" \
  -H "Authorization: Bearer $(api_key)" \
  -H "Content-Type: application/json" \
  -X $method $@
