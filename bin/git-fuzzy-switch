#!/bin/bash
#
# Use fuzzy-find to switch between Git branches
# You can alias this to "git sw" for quick switching between branches, checking out remotes or fuzzy
# searching, etc. Depends on https://github.com/junegunn/fzf

# TODO(tim.uruski) The --preview option doesn't work when put in here.
FZF_OPTS="--no-info --reverse"

# Using a bare "-" in the if statement breaks.
PREV="-"

branches() {
  git branch --sort='-committerdate'
}

if [[ $# -eq 0 ]]; then
  branches | fzf $FZF_OPTS --preview 'git show {+1}' | xargs git checkout
elif [[ -f ".git/refs/remotes/origin/${1}" ]]; then
  git checkout $1
elif [[ "${1}" = $PREV ]]; then
  git checkout $PREV
else
  branches | fzf $FZF_OPTS --preview 'git show {+1}' --exact --select-1 --query $1 | xargs git checkout
fi
